<!DOCTYPE html>
<!--<html lang="en" manifest="clock.manifest">-->
<html>
<head>
<meta charset=utf-8 />
<title>HTML5 Clock</title>
<!--[if IE]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->


<!-- For mobile and tablet devices -->
	<meta name="viewport" id="viewport" content="width=device-width, user-scalable=no, minimum-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">


<style>


	@font-face {
	    font-family: 'Digital7Mono';
	    src: url('digital-7_mono-webfont.eot');
	    src: url('digital-7_mono-webfont.eot?#iefix') format('embedded-opentype'),
	         url('digital-7_mono-webfont.woff') format('woff'),
	         url('digital-7_mono-webfont.ttf') format('truetype'),
	         url('digital-7_mono-webfont.svg#Digital7Mono') format('svg');
	    font-weight: normal;
	    font-style: normal;


	}


  /* Base reset and layout */
  html, body { height: 100%; }
  body{
    margin: 0;
    background: #000;
    display: grid;
    place-items: center;
    min-height: 100vh;
  }

  /* Center and scale the canvas responsively */
  #c{
    display: block;
    height: clamp(300px, 92vmin, 1600px);
    width: auto;
  }

  /* Very large displays (e.g., 4K) */
  @media (min-width: 2560px) {
    #c { height: 95vmin; }
  }

  /* iPhones and small phones */
  @media (max-width: 480px) {
    #c { height: 96vmin; }
  }

  /* iPads and tablets */
  @media (min-width: 768px) and (max-width: 1024px) {
    #c { height: 88vmin; }
  }

  /* Settings button */
  .settings-btn {
    position: fixed;
    top: 12px;
    right: 12px;
    background: #222;
    color: #fff;
    border: 1px solid #444;
    border-radius: 6px;
    padding: 6px 10px;
    font: 14px/1.3 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    cursor: pointer;
  }

  /* Dialog (modal) styles */
  dialog {
    border: 1px solid #333;
    border-radius: 10px;
    padding: 0;
    width: min(92vw, 420px);
    color: #eaeaea;
    background: #121212;
  }
  dialog::backdrop { background: rgba(0,0,0,0.6); }
  .dlg-header {
    padding: 14px 16px;
    font-weight: 600;
    color: #fff;
    /* background color is set dynamically from chosen color */
  }
  .dlg-body { padding: 14px 16px; display: grid; gap: 12px; }
  .dlg-row { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
  .dlg-row label { font-size: 14px; }
  .dlg-footer { padding: 12px 16px; display: flex; justify-content: flex-end; gap: 8px; border-top: 1px solid #2a2a2a; }
  .btn { background: #1e1e1e; color:#fff; border:1px solid #444; border-radius:6px; padding:8px 12px; cursor:pointer; }
  .btn.primary { background:#2a2a2a; border-color:#555; }
</style>
</head>
<body>
<button class="settings-btn" id="openSettings" aria-haspopup="dialog">Settings</button>
<canvas height="500" width="400" id="c"></canvas>

<dialog id="settingsDialog">
  <div class="dlg-header" id="dlgHeader">Clock Settings</div>
  <div class="dlg-body">
    <div class="dlg-row">
      <label for="colorPicker">Accent color</label>
      <input type="color" id="colorPicker" value="#005aff" />
    </div>
    <div class="dlg-row">
      <label for="keepAwake">Keep screen awake</label>
      <input type="checkbox" id="keepAwake" />
    </div>
    <div class="dlg-row" id="wakeLockNote" style="display:none;color:#bbb;">
      Screen Wake Lock not supported on this browser.
    </div>
  </div>
  <div class="dlg-footer">
    <button class="btn" id="closeDlg">Close</button>
  </div>
  
</dialog>


<script type="text/javascript">

(function() {
         if(window.applicationCache)
         {
              if(window.applicationCache.status == 4)
              {
                  window.applicationCache.update();
                  window.applicationCache.swapCache();
              }
         }
         var hasStorage = (function() {
      		try {
      			var mod = "lame";
        		localStorage.setItem(mod, mod);
       			localStorage.removeItem(mod);
       			return true;
      		} 
      		catch(e) {
        		return false;
      		}
    	}());

         if(hasStorage) {
        	if(localStorage.getItem("clockColor") != null) {
        		var cc = localStorage.getItem("clockColor").split(",");
        		window.clockColor = [parseInt(cc[0],10),parseInt(cc[1],10),parseInt(cc[2],10)];
        	}
        	else {
        		window.clockColor = [0,90,255];
        	}
         }
         else {
         	window.clockColor = [0,90,255];
         }
    window.setClockColor = function(a) {
    	if(Array.isArray(a) == true) {
    		window.clockColor = a;
    		if(hasStorage) {
    			localStorage.setItem("clockColor",a);
    		}
    	}
    	else {
    		console.log("Error: Input is not an array");
    	}
    };

    window.getClockColor = function() {
    	if(hasStorage) {
			if(localStorage.getItem("clockColor") != null) {
				var cc = localStorage.getItem("clockColor").split(",");
				return [parseInt(cc[0],10),parseInt(cc[1],10),parseInt(cc[2],10)];
			}
			else{
				window.setClockColor([0,90,255]);
				var cc = localStorage.getItem("clockColor").split(",");
				return [parseInt(cc[0],10),parseInt(cc[1],10),parseInt(cc[2],10)];
			}
    	}
    	else {
    		return window.clockColor;
    	}
    };     
    // Utility: color conversions
    function rgbToHex(r,g,b){
      const toHex = (n)=> n.toString(16).padStart(2,'0');
      return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
    }
    function hexToRgb(hex){
      const v = hex.replace('#','');
      return [parseInt(v.slice(0,2),16), parseInt(v.slice(2,4),16), parseInt(v.slice(4,6),16)];
    }

    var c   = document.getElementById('c'), //Get the canvas element
	    ctx = c.getContext("2d"); //select the canvas.context
	    
    var BASE_W = 400, BASE_H = 500; // logical drawing space

    // Prepare canvas backing store for current CSS size and DPR, center content
    function setupCanvasForDPR(){
      var dpr = window.devicePixelRatio || 1;
      var rect = c.getBoundingClientRect();
      var cssW = rect.width;
      var cssH = rect.height;
      // Set backing resolution
      var targetW = Math.max(1, Math.round(cssW * dpr));
      var targetH = Math.max(1, Math.round(cssH * dpr));
      if (c.width !== targetW) c.width = targetW;
      if (c.height !== targetH) c.height = targetH;

      // Compute scale to fit BASE_W x BASE_H into CSS box
      var scale = Math.min(cssW / BASE_W, cssH / BASE_H);
      var offsetX = (cssW - BASE_W * scale) / 2;
      var offsetY = (cssH - BASE_H * scale) / 2;
      // Reset and apply transform: first scale by DPR, then by logical scale, then translate to center
      ctx.setTransform(1,0,0,1,0,0);
      ctx.setTransform(dpr * scale, 0, 0, dpr * scale, dpr * offsetX, dpr * offsetY);
    }

    //##########################
	//Format the date accordingly 
	//that if the value is less
	//than 10 then instead of 
	//printing "1"	print "01"
	//@RETURNS Array [[string,string,string],[string,string,string]]
	//##########################
	var createFormattedDate = function(d){ //UTIL function
		var	h  = d.getHours(), // get hours, seconds, minutes, year, day , month
			s  = d.getSeconds(),
			m  = d.getMinutes(),
			y  = d.getFullYear(),
			mn = (d.getMonth() + 1),
			dt = d.getDate(),
			dy;
		if(d.getHours() < 10)
		{
			h = 0 + d.getHours().toString();
		}
		if(d.getSeconds() < 10)
		{
			s = 0 + d.getSeconds().toString();
		}
		if(d.getMinutes() < 10)
		{
			m = 0 + d.getMinutes().toString();
		}
		if((d.getMonth()+1) < 10)
		{
			mn = 0 + (d.getMonth()+1).toString();
		}
		if(d.getDate() < 10)
		{
			dt = 0 + d.getDate().toString();
		}


		return [[h,m,s],[dt,mn,y]];


	};


	var getWeekdayFormatted = function(d){
		var dy;
		switch(d.getDay())
		{
			case 1:
				dy = "MON                        ";
			break;
			case 2:
				dy = "    TUE                    ";
			break;
			case 3:
				dy = "        WED                ";
			break;
			case 4:
				dy = "            THU            ";
			break;
			case 5:
				dy = "                FRI        ";
			break;
			case 6:
				dy = "                    SAT    ";
			break;
			case 0:
				dy = "                        SUN";
			break;
			default:
				dy = "                            UKN";
			break;
		};


		return dy;
	};


	// Render one tick (draw once)
	var r = function(){
		setupCanvasForDPR();
		var dt = new Date();
		var cC = window.getClockColor();
		//Get the date
		var d = createFormattedDate(dt);
	        //clear the board in logical units
		ctx.clearRect(0,0,BASE_W,BASE_H);
		//save the font
		ctx.font = "70pt Digital7Mono";
		//create a background for time
		ctx.fillStyle ="rgba(" + cC[0] + "," + cC[1] + "," + cC[2] + ",0.3)";
		ctx.fillText("88:88:88",10,210);
		//add the time
		ctx.fillStyle = "rgb(" + cC[0] + "," + cC[1] + "," + cC[2] + ")"; 
		ctx.fillText(d[0][0] + ":" + d[0][1] + ":" + d[0][2],10,210);
		//save the font and change the size 
		ctx.font = "50pt Digital7Mono";
		//create background
		ctx.fillStyle = "rgba(" + cC[0] + "," + cC[1] + "," + cC[2] + ",0.3)";
		ctx.fillText("88:88:8888",25,125);
		//DEFINED
		ctx.fillStyle = "rgb(" + cC[0] + "," + cC[1] + "," + cC[2] + ")";
		ctx.fillText( d[1][0] + ":" + d[1][1] + ":" + d[1][2], 25, 125 );
		//Display which day is it eg "WED"
		//Create a background
		ctx.font = "20pt Digital7Mono";
		ctx.fillStyle = "rgba(" + cC[0] + "," + cC[1] + "," + cC[2] + ",0.2)";
		ctx.fillText("888 888 888 888 888 888 888",20, 265);
		//Now put a light layer of the days
		ctx.fillStyle = "rgba(" + cC[0] + "," + cC[1] + "," + cC[2] + ",0.4)";
		ctx.fillText("MON TUE WED THU FRI SAT SUN",20, 265);
		//Now get the weekday and display without transparency
		ctx.fillStyle = "rgb(" + cC[0] + "," + cC[1] + "," + cC[2] + ")";
		ctx.fillText(getWeekdayFormatted(dt),20,265);
	};

	// Schedule next update aligned to next second boundary
	function scheduleNextTick(){
	  var now = new Date();
	  var delay = 1000 - now.getMilliseconds();
	  setTimeout(function(){
	    r();
	    scheduleNextTick();
	  }, delay);
	}

	// Redraw on resize/orientation to adapt DPR and size instantly
	window.addEventListener('resize', r);
	window.addEventListener('orientationchange', r);

	// Dialog wiring (color + wake lock)
	var openBtn = document.getElementById('openSettings');
	var dlg = document.getElementById('settingsDialog');
	var dlgHeader = document.getElementById('dlgHeader');
	var colorInput = document.getElementById('colorPicker');
	var closeDlg = document.getElementById('closeDlg');
	var keepAwakeCheckbox = document.getElementById('keepAwake');
	var wakeLockNote = document.getElementById('wakeLockNote');

	function applyHeaderColor(){
	  var cC = window.getClockColor();
	  dlgHeader.style.backgroundColor = 'rgb(' + cC[0] + ',' + cC[1] + ',' + cC[2] + ')';
	}

	// Initialize color input from stored color
	(function initColorUI(){
	  var cC = window.getClockColor();
	  colorInput.value = rgbToHex(cC[0], cC[1], cC[2]);
	  applyHeaderColor();
	})();

	openBtn.addEventListener('click', function(){
	  applyHeaderColor();
	  if (typeof dlg.showModal === 'function') dlg.showModal();
	});
	closeDlg.addEventListener('click', function(){ dlg.close(); });
	colorInput.addEventListener('input', function(){
	  var rgb = hexToRgb(colorInput.value);
	  window.setClockColor(rgb);
	  applyHeaderColor();
	  r();
	});

	// Wake Lock (Keep Awake)
	var wakeLock = null;
	var keepAwakeEnabled = false;
	if (!('wakeLock' in navigator)) {
	  wakeLockNote.style.display = 'block';
	}

	async function requestWakeLock(){
	  try {
	    wakeLock = await navigator.wakeLock.request('screen');
	    wakeLock.addEventListener('release', function(){
	      if (keepAwakeEnabled && document.visibilityState === 'visible') {
	        var retry = confirm('Screen wake lock was released. Re-enable?');
	        if (retry) requestWakeLock();
	      }
	    });
	  } catch (e) {
	    console.warn('Wake Lock request failed:', e);
	    var retry = confirm('Unable to keep screen awake. Try again?');
	    if (retry) requestWakeLock();
	  }
	}

	function releaseWakeLock(){
	  try { if (wakeLock) { wakeLock.release(); } } catch(e) {}
	  wakeLock = null;
	}

	keepAwakeCheckbox.addEventListener('change', function(){
	  keepAwakeEnabled = keepAwakeCheckbox.checked;
	  if (keepAwakeEnabled && 'wakeLock' in navigator) {
	    requestWakeLock();
	  } else {
	    releaseWakeLock();
	  }
	});

	document.addEventListener('visibilitychange', function(){
	  if (document.visibilityState === 'visible' && keepAwakeEnabled && 'wakeLock' in navigator) {
	    requestWakeLock();
	  }
	});

	// Initial draw and start 1-second ticking
	r();
	scheduleNextTick();
})();
</script>
</body>
</html>

 
